<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CÃ¢y TrÃ¡i Tim ðŸ’–</title>

<style>
body{
    margin:0;
    overflow:hidden;
    height:100vh;
    background:#fdfdfd;
}

#heartBtn{
    position:absolute;
    top:45%;
    left:50%;
    transform:translate(-50%,-50%);
    font-size:70px;
    cursor:pointer;
    z-index:10;
    animation:pulse 1.5s infinite;
    user-select:none;
}

@keyframes pulse{
    0%{transform:translate(-50%,-50%) scale(1)}
    50%{transform:translate(-50%,-50%) scale(1.2)}
    100%{transform:translate(-50%,-50%) scale(1)}
}

.fall{
    animation:drop 1.8s forwards ease-in;
}

@keyframes drop{
    to{ top:80%; }
}

canvas{
    position:absolute;
    top:0;
    left:0;
}
</style>
</head>

<body>

<div id="heartBtn">ðŸ’—</div>
<canvas id="canvas"></canvas>

<script>
const heartBtn = document.getElementById("heartBtn");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

heartBtn.addEventListener("click", startAnimation);
heartBtn.addEventListener("touchstart", startAnimation);

function startAnimation(){
    heartBtn.classList.add("fall");
    setTimeout(()=>{
        heartBtn.style.display="none";
        growTree();
    },1800);
}

function growTree(){

    let trunkHeight = 0;
    let maxHeight = 260;
    let centerX = canvas.width/2;
    let baseY = canvas.height*0.9;

    let grow = setInterval(()=>{

        ctx.clearRect(0,0,canvas.width,canvas.height);

        // ThÃ¢n cÃ¢y Ä‘en
        ctx.fillStyle="#111";
        ctx.fillRect(centerX-18, baseY-trunkHeight, 36, trunkHeight);

        trunkHeight+=3;

        if(trunkHeight>=maxHeight){
            clearInterval(grow);
            bloomHeart(centerX, baseY-maxHeight);
        }

    },20);
}

function bloomHeart(cx, topY){

    let scale = 14;
    let points = [];

    // QuÃ©t toÃ n bá»™ lÆ°á»›i Ä‘á»ƒ Ä‘áº£m báº£o kÃ­n 100%
    for(let x=-18; x<=18; x+=0.5){
        for(let y=-18; y<=18; y+=0.5){

            let formula = Math.pow(x*x + y*y - 1,3) - x*x*y*y*y;

            if(formula <= 0){
                points.push({
                    x: cx + x*scale,
                    y: topY - y*scale
                });
            }
        }
    }

    // XÃ¡o trá»™n Ä‘á»ƒ ná»Ÿ tá»± nhiÃªn
    points.sort(()=>Math.random()-0.5);

    let colors = ["ðŸ’–","ðŸ’—","ðŸ’˜","ðŸ’","ðŸ’“","ðŸ’ž"];

    let i = 0;

    let bloom = setInterval(()=>{

        if(i >= points.length){
            clearInterval(bloom);
            return;
        }

        let flower = document.createElement("div");
        flower.innerHTML = colors[Math.floor(Math.random()*colors.length)];
        flower.style.position="absolute";
        flower.style.fontSize = (18 + Math.random()*8) + "px";
        flower.style.left = points[i].x + (Math.random()*6-3) + "px";
        flower.style.top  = points[i].y + (Math.random()*6-3) + "px";
        flower.style.opacity="0";
        flower.style.transform="scale(0)";
        flower.style.transition="0.3s ease";

        document.body.appendChild(flower);

        setTimeout(()=>{
            flower.style.opacity="1";
            flower.style.transform="scale(1)";
        },50);

        i++;

    },5); // tá»‘c Ä‘á»™ ná»Ÿ mÆ°á»£t vÃ  dÃ y
}
</script>

</body>
</html>
